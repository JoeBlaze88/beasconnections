<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bea's Connections</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --text:#e5e7eb; --muted:#94a3b8;
      --tile:#1f2937; --tile-border:#374151; --tile-selected:#2563eb;
      --good:#22c55e; --bad:#ef4444; --yellow:#facc15; --green:#22c55e; --blue:#60a5fa; --purple:#a78bfa;
    }
    html,body{height:100%}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--text); display:flex; align-items:center; justify-content:center; padding:20px}
    .wrap{max-width:960px; width:100%}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:14px}
    h1{font-size:clamp(20px,3vw,28px); margin:0}
    .sub{opacity:.8; font-weight:600}
    .lives{display:flex; gap:6px; align-items:center; font-weight:600}
    .life{width:14px; height:14px; border-radius:50%; background:var(--good); opacity:.25}
    .life.live{opacity:1}
    .board{display:grid; grid-template-columns:repeat(4,1fr); gap:10px}
    .tile{user-select:none; background:var(--tile); border:2px solid var(--tile-border); color:var(--text); border-radius:10px; padding:16px 10px; text-align:center; font-weight:700; cursor:pointer; transition:transform .05s ease, background .15s ease, border-color .15s ease}
    .tile:hover{transform:translateY(-1px)}
    .tile.selected{background:var(--tile-selected); border-color:#3b82f6}
    .controls{display:flex; gap:10px; margin:14px 0 18px; flex-wrap:wrap}
    button{background:#334155; color:#fff; border:none; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; transition:opacity .15s ease, transform .05s ease}
    button:active{transform:translateY(1px)}
    button[disabled]{opacity:.45; cursor:not-allowed}
    .msg{min-height:22px; color:var(--muted); margin-bottom:10px; font-weight:600}
    .solved{display:grid; gap:8px; margin-top:14px}
    .group-row{display:flex; align-items:center; gap:8px; padding:12px; border-radius:12px; font-weight:800; color:#0b1020}
    .group-words{opacity:.85; font-weight:700}
    .footer{margin-top:18px; color:var(--muted); font-size:14px}
    .final{margin-top:20px; text-align:center; font-size:1.6rem; font-weight:900}
    .final .big{display:block; font-size:2rem; margin-top:6px}
    @media (max-width:520px){.tile{padding:14px 8px; font-size:14px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Bea's Connections</h1>
        <div class="sub" id="subtitle"></div>
      </div>
      <div class="lives" id="lives"></div>
    </header>

    <div class="msg" id="message">Select 4 words that form a group.</div>
    <div class="board" id="board"></div>

    <div class="controls">
      <button id="submitBtn" disabled>Submit</button>
      <button id="deselectBtn" disabled>Deselect</button>
      <button id="shuffleBtn">Shuffle</button>
    </div>

    <div class="solved" id="solved"></div>
    <div class="footer">Inspired by NYT Connections. Custom puzzles just for you.</div>
  </div>

  <script>
    // ===== All 5 puzzles =====
    const PUZZLES = [
      {
        title: "Puzzle 1",
        groups: [
          { name: "Start with body parts", answers: ["Lunge","Headmaster","Handy","Shine"] },
          { name: "_____ Table", answers: ["Coffee","End","Poker","Pinball"] },
          { name: "Things you can peel", answers: ["Paint","Orange","Skin","Rubber"] },
          { name: "Associated with October", answers: ["Pumpkin Spice","Candy","Columbus","Mask"] }
        ],
        mistakesAllowed: 4
      },
      {
        title: "Puzzle 2",
        groups: [
          { name: "Things you put on your face", answers: ["Makeup","Goggles","Halloween mask","Sunscreen"] },
          { name: "Ends with an animal", answers: ["Copycat","Bookworm","Packrat","Scapegoat"] },
          { name: "First word in soda's", answers: ["Mountain","Dr.","Root","Ginger"] },
          { name: "Words that start with basketball terms", answers: ["Netflix","Hoopla","Courtroom","Dunkin Donuts"] }
        ],
        mistakesAllowed: 4
      },
      {
        title: "Puzzle 3",
        groups: [
          { name: "Contain first names", answers: ["Drivers ed","Jack-o-lantern","Mason jar","Graham cracker"] },
          { name: "Things in our backyard", answers: ["Connect 4","Pirate ship","Bird house","Fire pit"] },
          { name: "Palindromes", answers: ["Noon","Level","Kayak","Rotator"] },
          { name: "To get rid of", answers: ["Shed","Eliminate","Scrap","Dump"] }
        ],
        mistakesAllowed: 4
      },
      {
        title: "Puzzle 4",
        groups: [
          { name: "Words containing numbers", answers: ["Network","Canine","Freight","Content"] },
          { name: "_____ Fall", answers: ["Free","Water","Pit","Night"] },
          { name: "Things with prizes inside", answers: ["Cracker jacks","Kinder Egg","Cereal","Happy meal"] },
          { name: "Things that are salty", answers: ["Tears","Popcorn","Ocean","Saline Solution"] }
        ],
        mistakesAllowed: 4
      },
      {
        title: "Puzzle 5",
        groups: [
          { name: "Charlotte Hornets Players", answers: ["Ball","Bridges","Knueppel","Curry"] },
          { name: "Things you would order in a Thai restaurant", answers: ["Spring Roll","Iced Tea","Drunken Noodles","Satay"] },
          { name: "Popular singers from the 90's last names", answers: ["Twain","Carey","Dion","Houston"] },
          { name: "Stephen King Novels", answers: ["Misery","Carrie","Dreamcatcher","Insomnia"] }
        ],
        mistakesAllowed: 4
      }
    ];

    const colors = ["var(--yellow)","var(--green)","var(--blue)","var(--purple)"];

    const boardEl = document.getElementById('board');
    const messageEl = document.getElementById('message');
    const submitBtn = document.getElementById('submitBtn');
    const deselectBtn = document.getElementById('deselectBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const solvedEl = document.getElementById('solved');
    const livesEl = document.getElementById('lives');
    const subtitleEl = document.getElementById('subtitle');

    let currentIndex = 0, currentPuzzle;
    let pool = [], remainingGroups = [], selected = new Set(), solvedCount = 0, mistakesLeft = 0;

    const shuffle = arr => { for (let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; };

    function renderLives(){
      livesEl.innerHTML = "Mistakes: " + Array.from({length:currentPuzzle.mistakesAllowed}).map((_,i)=>`<span class="life ${i < mistakesLeft ? 'live' : ''}"></span>`).join('');
    }

    function toast(msg, good=false){ messageEl.textContent = msg; messageEl.style.color = good ? 'var(--good)' : 'var(--muted)'; }

    function renderBoard(){
      boardEl.innerHTML = '';
      pool.forEach(word => {
        const el = document.createElement('button');
        el.textContent = word;
        el.className = 'tile';
        el.setAttribute('data-word', word);
        el.onclick = () => toggleSelect(word, el);
        boardEl.appendChild(el);
      });
      updateButtons();
    }

    function toggleSelect(word, el){
      if (selected.has(word)) { selected.delete(word); el.classList.remove('selected'); }
      else if (selected.size < 4) { selected.add(word); el.classList.add('selected'); }
      updateButtons();
    }

    function updateButtons(){
      submitBtn.disabled = selected.size !== 4;
      deselectBtn.disabled = selected.size === 0;
    }

    function deselectAll(){
      selected.clear();
      document.querySelectorAll('.tile.selected').forEach(t=>t.classList.remove('selected'));
      updateButtons(); toast('Selections cleared.');
    }

    function shuffleTiles(){
      const children = Array.from(boardEl.children);
      shuffle(children); children.forEach(c=>boardEl.appendChild(c));
      toast('Shuffled.');
    }

    function submit(){
      if (selected.size !== 4) return;
      const pick = Array.from(selected);
      const idx = remainingGroups.findIndex(g => g.answers.every(a => pick.includes(a)));
      if (idx !== -1){
        const group = remainingGroups.splice(idx,1)[0];
        solvedCount++; lockInGroup(group); deselectAll();
        if (remainingGroups.length === 0) endGame(true); else toast('Correct! Keep going.', true);
      } else {
        mistakesLeft--; flashWrong(pick); renderLives();
        if (mistakesLeft <= 0) endGame(false); else toast(`Not a group. ${mistakesLeft===1?'':'s'} left.`.replace(" 0", " 0"));
      }
    }

    function flashWrong(words){
      words.forEach(w=>{
        const el = document.querySelector(`.tile[data-word="${CSS.escape(w)}"]`);
        if (el){ el.animate([{transform:'translateX(0)'},{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],{duration:200,easing:'ease-out'}); }
      });
    }

    function lockInGroup(group){
      pool = pool.filter(w => !group.answers.includes(w));
      renderBoard();
      const row = document.createElement('div');
      row.className = 'group-row';
      row.style.background = colors[solvedCount-1] || 'var(--yellow)';
      row.innerHTML = `<div>${group.name}</div><div class="group-words"> â€” ${group.answers.join(', ')}</div>`;
      solvedEl.appendChild(row);
    }

    function buildShare(win){
      const colorEmojis = ['ðŸŸ¨','ðŸŸ©','ðŸŸ¦','ðŸŸª'];
      const colorGrid = Array(16).fill('â¬›');
      let idx = 0; for (let c=0;c<solvedCount;c++){ for (let k=0;k<4;k++) colorGrid[idx++] = colorEmojis[c]; }
      const lines = []; for (let r=0;r<4;r++) lines.push(colorGrid.slice(r*4,(r+1)*4).join(''));
      const title = `Bea's Connections â€” ${currentPuzzle.title} â€” ${win? 'Solved':'Failed'} â€” Mistakes used: ${currentPuzzle.mistakesAllowed - mistakesLeft}/${currentPuzzle.mistakesAllowed}`;
      return `${title}
${lines.join('
')}`;
    }

    function endGame(win){
      submitBtn.disabled = true; deselectBtn.disabled = true; shuffleBtn.disabled = true;
      const summary = buildShare(win);
      if (win) toast('You solved it! âœ¨', true); else { toast('Out of mistakes. Puzzle over.'); remainingGroups.forEach(g=>lockInGroup(g)); }

      const shareBtn = document.createElement('button');
      shareBtn.textContent = 'Copy Results';
      shareBtn.onclick = async ()=>{ try{ await navigator.clipboard.writeText(summary); toast('Results copied to clipboard!', true);} catch(e){ toast('Could not copy automatically. Long-press to copy.'); } };
      document.querySelector('.controls').appendChild(shareBtn);

      if (currentIndex < PUZZLES.length - 1){
        const nextBtn = document.createElement('button'); nextBtn.textContent = 'Next Puzzle â–¶';
        nextBtn.onclick = ()=>loadPuzzle(currentIndex + 1);
        document.querySelector('.controls').appendChild(nextBtn);
      } else {
        // Final celebration message
        const final = document.createElement('div');
        final.className = 'final';
        final.innerHTML = `ðŸŽ‰ You're done. <span class="big">Congratulations. HAPPY BIRTHDAY!</span> ðŸŽ‰`;
        document.querySelector('.wrap').appendChild(final);
        // Optional: Restart button
        const restart = document.createElement('button');
        restart.textContent = 'Play Again From Start';
        restart.onclick = ()=>loadPuzzle(0);
        document.querySelector('.controls').appendChild(restart);
      }
    }

    function loadPuzzle(i){
      currentIndex = i; currentPuzzle = PUZZLES[i];
      // Reset state
      pool = shuffle(currentPuzzle.groups.flatMap(g=>g.answers));
      remainingGroups = currentPuzzle.groups.map(g=>({...g}));
      selected = new Set(); solvedCount = 0; mistakesLeft = currentPuzzle.mistakesAllowed;
      // Reset UI
      solvedEl.innerHTML = ''; messageEl.textContent = ''; submitBtn.disabled = true; deselectBtn.disabled = true; shuffleBtn.disabled = false;
      // Remove any extra buttons from prior end screens
      document.querySelectorAll('.controls button').forEach(btn=>{ if (btn.textContent.startsWith('Copy Results') || btn.textContent.startsWith('Next Puzzle') || btn.textContent.startsWith('Play Again')) btn.remove(); });
      const finalEl = document.querySelector('.final'); if (finalEl) finalEl.remove();

      renderLives(); renderBoard();
      subtitleEl.textContent = `${currentPuzzle.title} â€” ${i+1} of ${PUZZLES.length}`;
      toast('Select four words that go together. You have ' + currentPuzzle.mistakesAllowed + ' mistakes.');
    }

    // Wire up buttons
    submitBtn.onclick = submit; deselectBtn.onclick = deselectAll; shuffleBtn.onclick = shuffleTiles;

    // Init first puzzle
    loadPuzzle(0);
  </script>
</body>
</html>
